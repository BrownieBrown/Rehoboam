version: '3.8'

services:
  rehoboam:
    build: .
    container_name: rehoboam-trading-bot
    restart: unless-stopped
    env_file:
      - .env
    volumes:
      # Mount .env for easy credential updates without rebuilding
      - ./.env:/app/.env:ro
      # Persist logs to home directory (daemon logs here)
      - ~/.rehoboam/logs:/root/.rehoboam/logs
    environment:
      - TZ=Europe/Berlin  # Set your timezone
    command: >
      daemon
      --interval 180
      --max-trades 3
      --max-spend 30000000
      --start-hour 8
      --end-hour 22
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

  # One-off service for manual trading runs
  manual:
    build: .
    container_name: rehoboam-manual
    env_file:
      - .env
    volumes:
      - ./.env:/app/.env:ro
    profiles:
      - manual
    entrypoint: ["/usr/local/bin/rehoboam"]
    # Usage: docker-compose run manual analyze
    #        docker-compose run manual trade --max 3
